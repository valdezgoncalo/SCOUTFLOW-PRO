<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScoutFlow Pro | Advanced Edition 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { 
            --primary-green: #10b981; 
            --dark-green: #059669;
            --light-green: #d1fae5;
        }
        body { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); font-family: 'Inter', -apple-system, sans-serif; color: #1e293b; min-height: 100vh; }
        .glass-card { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border: 1px solid rgba(226,232,240,0.8); box-shadow: 0 8px 32px rgba(0,0,0,0.06); border-radius: 20px; }
        .btn-green { background: var(--primary-green); color: white; transition: all 0.3s ease; }
        .btn-green:hover { background: var(--dark-green); transform: translateY(-2px); box-shadow: 0 10px 20px rgba(16,185,129,0.3); }
        .btn-outline { border: 2px solid var(--primary-green); color: var(--primary-green); background: white; transition: all 0.3s; }
        .btn-outline:hover { background: var(--primary-green); color: white; }
        .input-style { border: 1.5px solid #e2e8f0; border-radius: 12px; padding: 10px 14px; width: 100%; outline: none; transition: all 0.2s; background: white; }
        .input-style:focus { border-color: var(--primary-green); box-shadow: 0 0 0 3px rgba(16,185,129,0.1); }
        .hidden { display: none !important; }
        .tag { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .tag-promessa { background: #fef3c7; color: #92400e; }
        .tag-urgente { background: #fee2e2; color: #991b1b; }
        .tag-monitorar { background: #dbeafe; color: #1e40af; }
        .tag-descartado { background: #f1f5f9; color: #475569; }
        .tag-contactado { background: #d1fae5; color: #065f46; }
        .badge { position: absolute; top: 12px; right: 12px; padding: 6px 12px; border-radius: 12px; font-size: 10px; font-weight: 900; text-transform: uppercase; backdrop-filter: blur(10px); }
        .metric-bar { height: 8px; background: #e2e8f0; border-radius: 10px; overflow: hidden; position: relative; }
        .metric-fill { height: 100%; background: linear-gradient(90deg, var(--primary-green), var(--dark-green)); transition: width 0.5s ease; }
        .position-badge { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 8px 16px; border-radius: 12px; font-weight: 900; font-size: 12px; letter-spacing: 1px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.4s ease; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 24px; max-width: 90vw; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.3); }
        .stat-card { background: linear-gradient(135deg, #ffffff, #f8fafc); border-left: 4px solid var(--primary-green); }
        .video-embed { aspect-ratio: 16/9; border-radius: 16px; overflow: hidden; }
        select.input-style { cursor: pointer; }
        .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .radar-container { position: relative; height: 300px; }
        .filter-chip { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; background: white; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .filter-chip:hover { border-color: var(--primary-green); background: var(--light-green); }
        .filter-chip.active { background: var(--primary-green); color: white; border-color: var(--primary-green); }
        .timeline-item { position: relative; padding-left: 30px; padding-bottom: 20px; border-left: 2px solid #e2e8f0; }
        .timeline-item:last-child { border-left: none; }
        .timeline-dot { position: absolute; left: -6px; top: 0; width: 12px; height: 12px; background: var(--primary-green); border-radius: 50%; }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring-circle { transition: stroke-dashoffset 0.5s; }
        .dark-mode body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: #e2e8f0; }
        .dark-mode .glass-card { background: rgba(30,41,59,0.95); border-color: rgba(71,85,105,0.3); }
        .dark-mode .input-style { background: #1e293b; border-color: #334155; color: #e2e8f0; }
        .quick-stat { text-align: center; padding: 20px; }
        .quick-stat-value { font-size: 32px; font-weight: 900; color: var(--primary-green); }
        .quick-stat-label { font-size: 12px; text-transform: uppercase; color: #64748b; font-weight: 700; margin-top: 4px; }
    </style>
</head>
<body>

    <!-- NAVIGATION -->
    <nav class="bg-white/95 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="showView('home')">
                <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-xl flex items-center justify-center text-white font-black group-hover:rotate-12 transition-transform shadow-lg">
                    <span class="text-xl">‚öΩ</span>
                </div>
                <div>
                    <h1 class="text-xl font-black text-slate-800 tracking-tight">SCOUTFLOW PRO</h1>
                    <p class="text-[9px] text-slate-400 font-bold uppercase tracking-wider">Advanced Edition</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="showView('home')" class="text-slate-600 font-bold hover:text-emerald-600 transition px-3">
                    <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    Diret√≥rio
                </button>
                <button onclick="showView('analytics')" class="text-slate-600 font-bold hover:text-emerald-600 transition px-3">
                    <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                    Analytics
                </button>
                <button onclick="showView('comparison')" class="text-slate-600 font-bold hover:text-emerald-600 transition px-3">
                    <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                    Comparar
                </button>
                <button onclick="prepareNewPlayer()" class="btn-green px-6 py-2.5 rounded-full font-bold text-sm shadow-lg hover:shadow-xl">
                    <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                    Novo Atleta
                </button>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-6">

        <!-- HOME VIEW -->
        <section id="view-home">
            <div class="py-8">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h2 class="text-4xl font-black text-slate-900">Base de Dados</h2>
                        <p class="text-slate-500 mt-1">Sistema inteligente de scouting profissional</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="exportAllData()" class="btn-outline px-5 py-2 rounded-xl font-bold text-sm">
                            <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                            Exportar Dados
                        </button>
                        <button onclick="importData()" class="btn-outline px-5 py-2 rounded-xl font-bold text-sm">
                            <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>
                            Importar
                        </button>
                    </div>
                </div>

                <!-- FILTERS -->
                <div class="glass-card p-6 mb-8">
                    <div class="flex flex-wrap gap-3 mb-4">
                        <input type="text" id="search-input" placeholder="üîç Pesquisar atleta, clube ou agente..." class="input-style flex-1 min-w-[300px]" oninput="applyFilters()">
                        <select id="filter-position" class="input-style w-48" onchange="applyFilters()">
                            <option value="">Todas as Posi√ß√µes</option>
                            <option value="GR">Guarda-Redes</option>
                            <option value="DC">Defesa Central</option>
                            <option value="LD">Lateral Direito</option>
                            <option value="LE">Lateral Esquerdo</option>
                            <option value="MC">M√©dio Centro</option>
                            <option value="MD">M√©dio Defensivo</option>
                            <option value="MO">M√©dio Ofensivo</option>
                            <option value="EXT">Extremo</option>
                            <option value="PL">Ponta de Lan√ßa</option>
                        </select>
                        <select id="filter-tag" class="input-style w-48" onchange="applyFilters()">
                            <option value="">Todas as Tags</option>
                            <option value="promessa">üåü Promessa</option>
                            <option value="urgente">üî• Urgente</option>
                            <option value="monitorar">üëÅÔ∏è Monitorar</option>
                            <option value="contactado">‚úÖ Contactado</option>
                            <option value="descartado">‚ùå Descartado</option>
                        </select>
                        <select id="sort-by" class="input-style w-48" onchange="applyFilters()">
                            <option value="recent">Mais Recentes</option>
                            <option value="name">Nome (A-Z)</option>
                            <option value="rating">Melhor Avalia√ß√£o</option>
                            <option value="age">Idade</option>
                        </select>
                    </div>
                    <div class="flex gap-2">
                        <span class="text-xs font-bold text-slate-400 uppercase">Filtros R√°pidos:</span>
                        <button class="filter-chip" onclick="quickFilter('age', 'sub21')">Sub-21</button>
                        <button class="filter-chip" onclick="quickFilter('rating', 'high')">Nota ‚â• 7.5</button>
                        <button class="filter-chip" onclick="quickFilter('contract', 'expiring')">Contrato a Expirar</button>
                        <button class="filter-chip" onclick="resetFilters()">Limpar Filtros</button>
                    </div>
                </div>

                <!-- PLAYER GRID -->
                <div id="player-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
            </div>
        </section>

        <!-- EDITOR VIEW -->
        <section id="view-editor" class="hidden space-y-6 fade-in">
            <div class="flex justify-between items-center">
                <button onclick="showView('home')" class="flex items-center gap-2 text-slate-500 hover:text-emerald-600 font-bold transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
                    Voltar ao Diret√≥rio
                </button>
                <div class="flex gap-3">
                    <button onclick="deletePlayer()" class="btn-outline px-5 py-2 rounded-xl font-bold text-sm border-red-500 text-red-500 hover:bg-red-500 hover:text-white">
                        <svg class="w-4 h-4 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                        Eliminar
                    </button>
                    <button onclick="exportPlayerPDF()" class="btn-outline px-5 py-2 rounded-xl font-bold text-sm">
                        <svg class="w-4 h-4 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
                        Exportar PDF
                    </button>
                    <button onclick="savePlayer()" class="btn-green px-8 py-2.5 rounded-xl font-bold shadow-lg">
                        <svg class="w-4 h-4 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                        Guardar Perfil
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- LEFT SIDEBAR -->
                <div class="space-y-6">
                    <!-- PHOTO -->
                    <div class="glass-card p-6 text-center">
                        <div id="photo-preview" class="w-full aspect-square bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl mb-4 border-2 border-dashed border-slate-200 flex items-center justify-center overflow-hidden cursor-pointer hover:border-emerald-500 transition" onclick="document.getElementById('photo-input').click()">
                            <div class="text-center">
                                <svg class="w-16 h-16 mx-auto text-slate-300 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                                <span class="text-slate-400 text-xs font-bold uppercase tracking-wider">Carregar Foto</span>
                            </div>
                        </div>
                        <input type="file" id="photo-input" class="hidden" accept="image/*" onchange="handlePhoto(this)">
                        <button onclick="document.getElementById('photo-input').click()" class="text-emerald-600 font-bold text-xs uppercase hover:underline">Alterar Imagem</button>
                    </div>

                    <!-- BIO INFO -->
                    <div class="glass-card p-6 space-y-4">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-3 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                            Dados Biogr√°ficos
                        </h3>
                        <input type="text" id="p-name" placeholder="Nome Completo *" class="input-style font-bold">
                        <input type="text" id="p-club" placeholder="Clube Atual" class="input-style">
                        
                        <div class="grid grid-cols-2 gap-3">
                            <input type="number" id="p-age" placeholder="Idade" class="input-style">
                            <input type="text" id="p-height" placeholder="Altura (cm)" class="input-style">
                        </div>

                        <select id="p-position" class="input-style font-bold">
                            <option value="">Posi√ß√£o Principal *</option>
                            <option value="GR">üß§ Guarda-Redes</option>
                            <option value="DC">üõ°Ô∏è Defesa Central</option>
                            <option value="LD">‚û°Ô∏è Lateral Direito</option>
                            <option value="LE">‚¨ÖÔ∏è Lateral Esquerdo</option>
                            <option value="MC">‚öôÔ∏è M√©dio Centro</option>
                            <option value="MD">üî∞ M√©dio Defensivo</option>
                            <option value="MO">‚ú® M√©dio Ofensivo</option>
                            <option value="EXT">‚ö° Extremo</option>
                            <option value="PL">üéØ Ponta de Lan√ßa</option>
                        </select>

                        <select id="p-position2" class="input-style">
                            <option value="">Posi√ß√£o Secund√°ria</option>
                            <option value="GR">üß§ Guarda-Redes</option>
                            <option value="DC">üõ°Ô∏è Defesa Central</option>
                            <option value="LD">‚û°Ô∏è Lateral Direito</option>
                            <option value="LE">‚¨ÖÔ∏è Lateral Esquerdo</option>
                            <option value="MC">‚öôÔ∏è M√©dio Centro</option>
                            <option value="MD">üî∞ M√©dio Defensivo</option>
                            <option value="MO">‚ú® M√©dio Ofensivo</option>
                            <option value="EXT">‚ö° Extremo</option>
                            <option value="PL">üéØ Ponta de Lan√ßa</option>
                        </select>

                        <select id="p-foot" class="input-style">
                            <option value="">P√© Preferencial</option>
                            <option value="Direito">Direito</option>
                            <option value="Esquerdo">Esquerdo</option>
                            <option value="Ambidestro">Ambidestro</option>
                        </select>

                        <input type="text" id="p-nationality" placeholder="Nacionalidade" class="input-style">
                        <input type="text" id="p-agent" placeholder="Agente / Empresa" class="input-style">
                    </div>

                    <!-- CONTRACT INFO -->
                    <div class="glass-card p-6 space-y-4">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-3 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                            Informa√ß√£o Contratual
                        </h3>
                        <input type="date" id="p-contract-end" placeholder="Fim de Contrato" class="input-style text-sm">
                        <input type="text" id="p-release-clause" placeholder="Cl√°usula Rescis√£o (‚Ç¨)" class="input-style">
                        <input type="text" id="p-market-value" placeholder="Valor de Mercado Estimado (‚Ç¨)" class="input-style">
                    </div>

                    <!-- TAGS & STATUS -->
                    <div class="glass-card p-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-3">Status & Tags</h3>
                        <div class="space-y-3">
                            <select id="p-tag" class="input-style font-bold">
                                <option value="">Sem Tag</option>
                                <option value="promessa">üåü Promessa</option>
                                <option value="urgente">üî• Urgente</option>
                                <option value="monitorar">üëÅÔ∏è Monitorar</option>
                                <option value="contactado">‚úÖ Contactado</option>
                                <option value="descartado">‚ùå Descartado</option>
                            </select>
                            <select id="p-negotiation" class="input-style">
                                <option value="">Estado Negocia√ß√£o</option>
                                <option value="inicial">Contacto Inicial</option>
                                <option value="negociacao">Em Negocia√ß√£o</option>
                                <option value="proposta">Proposta Enviada</option>
                                <option value="fechado">Fechado</option>
                                <option value="rejeitado">Rejeitado</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- MAIN CONTENT -->
                <div class="lg:col-span-3 space-y-6">
                    
                    <!-- STATS QUICK VIEW -->
                    <div class="glass-card p-6">
                        <div class="grid grid-cols-4 gap-4">
                            <div class="stat-card p-4 rounded-xl">
                                <div class="text-xs font-bold text-slate-400 uppercase mb-1">Golos</div>
                                <input type="number" id="p-goals" placeholder="0" class="input-style text-center font-black text-2xl">
                            </div>
                            <div class="stat-card p-4 rounded-xl">
                                <div class="text-xs font-bold text-slate-400 uppercase mb-1">Assist√™ncias</div>
                                <input type="number" id="p-assists" placeholder="0" class="input-style text-center font-black text-2xl">
                            </div>
                            <div class="stat-card p-4 rounded-xl">
                                <div class="text-xs font-bold text-slate-400 uppercase mb-1">Minutos</div>
                                <input type="number" id="p-minutes" placeholder="0" class="input-style text-center font-black text-2xl">
                            </div>
                            <div class="stat-card p-4 rounded-xl">
                                <div class="text-xs font-bold text-slate-400 uppercase mb-1">Jogos</div>
                                <input type="number" id="p-games" placeholder="0" class="input-style text-center font-black text-2xl">
                            </div>
                        </div>
                    </div>

                    <!-- METRICS EVALUATION -->
                    <div class="glass-card p-6">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 class="text-lg font-black text-slate-800">Avalia√ß√£o T√©cnica</h3>
                                <p class="text-xs text-slate-400">M√©tricas adaptadas √† posi√ß√£o selecionada</p>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-black text-emerald-600" id="overall-rating">-</div>
                                <div class="text-xs font-bold text-slate-400 uppercase">Nota Geral</div>
                            </div>
                        </div>
                        <div id="metrics-editor" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <!-- RADAR CHART -->
                    <div class="glass-card p-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-4">Perfil T√©cnico (Radar)</h3>
                        <div class="radar-container">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                    <!-- TACTICAL INFO -->
                    <div class="glass-card p-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                            An√°lise T√°tica
                        </h3>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="text-xs font-bold text-slate-600 mb-2 block">Estilo de Jogo</label>
                                <select id="p-playstyle" class="input-style">
                                    <option value="">Selecionar...</option>
                                    <option value="tecnico">T√©cnico / Habilidoso</option>
                                    <option value="fisico">F√≠sico / Potente</option>
                                    <option value="rapido">R√°pido / Explosivo</option>
                                    <option value="inteligente">Inteligente / Posicional</option>
                                    <option value="versatil">Vers√°til / Completo</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-slate-600 mb-2 block">Sistema Ideal</label>
                                <select id="p-system" class="input-style">
                                    <option value="">Selecionar...</option>
                                    <option value="433">4-3-3</option>
                                    <option value="442">4-4-2</option>
                                    <option value="352">3-5-2</option>
                                    <option value="4231">4-2-3-1</option>
                                    <option value="343">3-4-3</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-600 mb-2 block">Pontos Fortes</label>
                            <input type="text" id="p-strengths" placeholder="Ex: Remate de longe, Jogo a√©reo, Velocidade..." class="input-style">
                        </div>
                        <div class="mt-3">
                            <label class="text-xs font-bold text-slate-600 mb-2 block">Pontos a Melhorar</label>
                            <input type="text" id="p-weaknesses" placeholder="Ex: P√© esquerdo, Decis√£o defensiva..." class="input-style">
                        </div>
                    </div>

                    <!-- VIDEOS -->
                    <div class="glass-card p-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
                            V√≠deos & Recursos
                        </h3>
                        <div id="video-links" class="space-y-3">
                            <div class="flex gap-2">
                                <input type="url" placeholder="URL do v√≠deo (YouTube, Vimeo...)" class="input-style flex-1 video-url">
                                <input type="text" placeholder="Descri√ß√£o (opcional)" class="input-style flex-1 video-desc">
                                <button onclick="addVideoLink()" class="btn-green px-4 py-2 rounded-xl font-bold">+</button>
                            </div>
                        </div>
                        <div id="video-list" class="mt-4 space-y-2"></div>
                    </div>

                    <!-- INJURY HISTORY -->
                    <div class="glass-card p-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-3">Hist√≥rico de Les√µes</h3>
                        <textarea id="p-injuries" placeholder="Descrever les√µes anteriores, tempo de recupera√ß√£o, etc..." class="input-style h-24 resize-none"></textarea>
                    </div>

                    <!-- OBSERVATION NOTES -->
                    <div class="glass-card p-6">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-3">Observa√ß√µes de Campo</h3>
                        <textarea id="p-notes" placeholder="An√°lise detalhada do comportamento em jogo, mentalidade, posicionamento t√°tico..." class="input-style h-40 resize-none"></textarea>
                    </div>

                    <!-- EVALUATION HISTORY -->
                    <div class="glass-card p-6" id="evaluation-history-section" style="display: none;">
                        <h3 class="text-xs font-black text-slate-400 uppercase mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            Hist√≥rico de Avalia√ß√µes
                        </h3>
                        <div id="evaluation-timeline" class="space-y-4"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ANALYTICS VIEW -->
        <section id="view-analytics" class="hidden fade-in">
            <div class="py-8">
                <h2 class="text-4xl font-black text-slate-900 mb-2">Analytics Dashboard</h2>
                <p class="text-slate-500 mb-8">Estat√≠sticas e insights da base de dados</p>

                <!-- QUICK STATS -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="glass-card quick-stat">
                        <div class="quick-stat-value" id="stat-total">0</div>
                        <div class="quick-stat-label">Total Atletas</div>
                    </div>
                    <div class="glass-card quick-stat">
                        <div class="quick-stat-value text-blue-500" id="stat-avg-age">0</div>
                        <div class="quick-stat-label">Idade M√©dia</div>
                    </div>
                    <div class="glass-card quick-stat">
                        <div class="quick-stat-value text-purple-500" id="stat-avg-rating">0</div>
                        <div class="quick-stat-label">Avalia√ß√£o M√©dia</div>
                    </div>
                    <div class="glass-card quick-stat">
                        <div class="quick-stat-value text-orange-500" id="stat-promises">0</div>
                        <div class="quick-stat-label">Promessas</div>
                    </div>
                </div>

                <!-- CHARTS -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">Distribui√ß√£o por Posi√ß√£o</h3>
                        <canvas id="positionChart" height="250"></canvas>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">Distribui√ß√£o por Idade</h3>
                        <canvas id="ageChart" height="250"></canvas>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">Top 10 Atletas (Avalia√ß√£o)</h3>
                        <canvas id="topPlayersChart" height="250"></canvas>
                    </div>
                    <div class="glass-card p-6">
                        <h3 class="font-bold text-slate-800 mb-4">Tags de Status</h3>
                        <canvas id="tagsChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- COMPARISON VIEW -->
        <section id="view-comparison" class="hidden fade-in">
            <div class="py-8">
                <h2 class="text-4xl font-black text-slate-900 mb-2">Compara√ß√£o de Atletas</h2>
                <p class="text-slate-500 mb-8">Selecione at√© 3 atletas para comparar</p>

                <div class="glass-card p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <select id="compare-player-1" class="input-style" onchange="updateComparison()">
                            <option value="">Selecionar Atleta 1</option>
                        </select>
                        <select id="compare-player-2" class="input-style" onchange="updateComparison()">
                            <option value="">Selecionar Atleta 2</option>
                        </select>
                        <select id="compare-player-3" class="input-style" onchange="updateComparison()">
                            <option value="">Selecionar Atleta 3</option>
                        </select>
                    </div>
                </div>

                <div id="comparison-content" class="space-y-6"></div>
            </div>
        </section>

    </main>

    <script>
        // DATA STRUCTURES
        let players = JSON.parse(localStorage.getItem('scoutflow_advanced_v1')) || [];
        let currentId = null;
        let tempPhoto = "";
        let currentVideos = [];
        let radarChart = null;

        // POSITION-SPECIFIC METRICS
        const positionMetrics = {
            'GR': ["Reflexos", "Posicionamento", "Sa√≠da", "Passe Longo", "Jogo de P√©s", "Lideran√ßa"],
            'DC': ["Marca√ß√£o", "Interce√ß√£o", "Jogo A√©reo", "For√ßa", "Passe", "Posicionamento"],
            'LD': ["Velocidade", "Cruzamento", "Marca√ß√£o", "Resist√™ncia", "Passe", "1v1 Ofensivo"],
            'LE': ["Velocidade", "Cruzamento", "Marca√ß√£o", "Resist√™ncia", "Passe", "1v1 Ofensivo"],
            'MC': ["Passe", "Vis√£o de Jogo", "Controlo", "Resist√™ncia", "Posicionamento", "Finaliza√ß√£o"],
            'MD': ["Recupera√ß√£o", "Interce√ß√£o", "Marca√ß√£o", "Passe", "For√ßa", "Posicionamento"],
            'MO': ["Criatividade", "Passe", "Finaliza√ß√£o", "Drible", "Vis√£o de Jogo", "Decis√£o"],
            'EXT': ["Velocidade", "Drible", "Cruzamento", "Finaliza√ß√£o", "1v1", "Decis√£o"],
            'PL': ["Finaliza√ß√£o", "Posicionamento", "Jogo A√©reo", "For√ßa", "Movimenta√ß√£o", "1v1"]
        };

        const defaultMetrics = ["T√©cnica", "F√≠sico", "Mental", "T√°tico", "Velocidade", "Finaliza√ß√£o"];

        // UTILITY FUNCTIONS
        function generateId() {
            return Date.now() + Math.random().toString(36).substr(2, 9);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('pt-PT', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function calculateOverallRating(metrics) {
            const values = Object.values(metrics).map(v => parseFloat(v) || 0);
            if (values.length === 0) return 0;
            return (values.reduce((a, b) => a + b, 0) / values.length).toFixed(1);
        }

        function getYouTubeEmbedUrl(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? `https://www.youtube.com/embed/${match[2]}` : null;
        }

        // VIEW MANAGEMENT
        function showView(view) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            document.getElementById('view-' + view).classList.remove('hidden');
            
            if (view === 'home') {
                renderGrid();
            } else if (view === 'analytics') {
                renderAnalytics();
            } else if (view === 'comparison') {
                initComparison();
            }
        }

        // PLAYER GRID
        function renderGrid() {
            const grid = document.getElementById('player-grid');
            const filtered = getFilteredPlayers();
            
            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full glass-card p-20 text-center">
                        <svg class="w-20 h-20 mx-auto text-slate-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/></svg>
                        <p class="text-slate-400 text-lg font-bold">Nenhum atleta encontrado</p>
                        <p class="text-slate-300 text-sm mt-2">Experimente ajustar os filtros ou adicione um novo atleta</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filtered.map(p => {
                const rating = calculateOverallRating(p.metrics || {});
                const tagClass = p.tag ? `tag-${p.tag}` : '';
                const tagText = {
                    'promessa': 'üåü Promessa',
                    'urgente': 'üî• Urgente',
                    'monitorar': 'üëÅÔ∏è Monitorar',
                    'contactado': '‚úÖ Contactado',
                    'descartado': '‚ùå Descartado'
                };

                return `
                    <div class="glass-card overflow-hidden hover:scale-[1.02] hover:shadow-2xl transition-all cursor-pointer group" onclick="editPlayer('${p.id}')">
                        <div class="h-56 bg-gradient-to-br from-slate-100 to-slate-200 overflow-hidden relative">
                            ${p.photo ? `<img src="${p.photo}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">` : `
                                <div class="flex items-center justify-center h-full">
                                    <svg class="w-20 h-20 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                </div>
                            `}
                            ${p.position ? `<div class="badge bg-white/90 text-emerald-600">${p.position}</div>` : ''}
                            ${p.videos && p.videos.length > 0 ? `
                                <div class="absolute bottom-3 right-3 bg-red-500 p-2 rounded-full text-white shadow-lg">
                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>
                                </div>
                            ` : ''}
                        </div>
                        <div class="p-5">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex-1">
                                    <p class="text-[10px] font-bold text-emerald-500 uppercase tracking-wider">${p.club || 'Agente Livre'}</p>
                                    <h3 class="font-black text-slate-800 text-xl leading-tight">${p.name}</h3>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-black ${rating >= 7.5 ? 'text-emerald-500' : rating >= 6 ? 'text-blue-500' : 'text-slate-400'}">${rating}</div>
                                    <div class="text-[9px] text-slate-400 font-bold uppercase">Nota</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 text-xs text-slate-500 mb-3">
                                ${p.age ? `<span>üìÖ ${p.age} anos</span>` : ''}
                                ${p.height ? `<span>üìè ${p.height}cm</span>` : ''}
                                ${p.nationality ? `<span>üåç ${p.nationality}</span>` : ''}
                            </div>
                            ${p.tag ? `<span class="tag ${tagClass}">${tagText[p.tag]}</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // FILTERS
        function getFilteredPlayers() {
            let filtered = [...players];
            
            const search = document.getElementById('search-input')?.value.toLowerCase() || '';
            const position = document.getElementById('filter-position')?.value || '';
            const tag = document.getElementById('filter-tag')?.value || '';
            const sort = document.getElementById('sort-by')?.value || 'recent';
            
            if (search) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(search) ||
                    (p.club && p.club.toLowerCase().includes(search)) ||
                    (p.agent && p.agent.toLowerCase().includes(search))
                );
            }
            
            if (position) {
                filtered = filtered.filter(p => p.position === position || p.position2 === position);
            }
            
            if (tag) {
                filtered = filtered.filter(p => p.tag === tag);
            }
            
            // Sorting
            switch(sort) {
                case 'name':
                    filtered.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'rating':
                    filtered.sort((a, b) => calculateOverallRating(b.metrics || {}) - calculateOverallRating(a.metrics || {}));
                    break;
                case 'age':
                    filtered.sort((a, b) => (a.age || 0) - (b.age || 0));
                    break;
                default: // recent
                    filtered.sort((a, b) => (b.id || 0) - (a.id || 0));
            }
            
            return filtered;
        }

        function applyFilters() {
            renderGrid();
        }

        function quickFilter(type, value) {
            resetFilters();
            // Implement quick filter logic based on type/value
            if (type === 'age' && value === 'sub21') {
                players = players.filter(p => p.age && p.age < 21);
            } else if (type === 'rating' && value === 'high') {
                players = players.filter(p => calculateOverallRating(p.metrics || {}) >= 7.5);
            }
            renderGrid();
        }

        function resetFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('filter-position').value = '';
            document.getElementById('filter-tag').value = '';
            document.getElementById('sort-by').value = 'recent';
            players = JSON.parse(localStorage.getItem('scoutflow_advanced_v1')) || [];
            renderGrid();
        }

        // PLAYER EDITOR
        function prepareNewPlayer() {
            currentId = generateId();
            tempPhoto = "";
            currentVideos = [];
            document.querySelectorAll('input:not([type="file"]), textarea, select').forEach(i => i.value = "");
            document.getElementById('photo-preview').innerHTML = `
                <div class="text-center">
                    <svg class="w-16 h-16 mx-auto text-slate-300 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    <span class="text-slate-400 text-xs font-bold uppercase tracking-wider">Carregar Foto</span>
                </div>
            `;
            renderMetricsInputs({});
            renderVideoList();
            document.getElementById('evaluation-history-section').style.display = 'none';
            showView('editor');
        }

        function editPlayer(id) {
            const p = players.find(x => x.id === id);
            if (!p) return;
            
            currentId = id;
            tempPhoto = p.photo || "";
            currentVideos = p.videos || [];
            
            // Fill form fields
            document.getElementById('p-name').value = p.name || "";
            document.getElementById('p-club').value = p.club || "";
            document.getElementById('p-age').value = p.age || "";
            document.getElementById('p-height').value = p.height || "";
            document.getElementById('p-position').value = p.position || "";
            document.getElementById('p-position2').value = p.position2 || "";
            document.getElementById('p-foot').value = p.foot || "";
            document.getElementById('p-nationality').value = p.nationality || "";
            document.getElementById('p-agent').value = p.agent || "";
            document.getElementById('p-contract-end').value = p.contractEnd || "";
            document.getElementById('p-release-clause').value = p.releaseClause || "";
            document.getElementById('p-market-value').value = p.marketValue || "";
            document.getElementById('p-tag').value = p.tag || "";
            document.getElementById('p-negotiation').value = p.negotiation || "";
            document.getElementById('p-goals').value = p.goals || "";
            document.getElementById('p-assists').value = p.assists || "";
            document.getElementById('p-minutes').value = p.minutes || "";
            document.getElementById('p-games').value = p.games || "";
            document.getElementById('p-playstyle').value = p.playstyle || "";
            document.getElementById('p-system').value = p.system || "";
            document.getElementById('p-strengths').value = p.strengths || "";
            document.getElementById('p-weaknesses').value = p.weaknesses || "";
            document.getElementById('p-injuries').value = p.injuries || "";
            document.getElementById('p-notes').value = p.notes || "";
            
            if (p.photo) {
                document.getElementById('photo-preview').innerHTML = `<img src="${p.photo}" class="w-full h-full object-cover">`;
            }
            
            renderMetricsInputs(p.metrics || {}, p.position);
            renderVideoList();
            renderEvaluationHistory(p.evaluationHistory || []);
            
            showView('editor');
        }

        function renderMetricsInputs(data, position) {
            const container = document.getElementById('metrics-editor');
            const selectedPosition = position || document.getElementById('p-position').value;
            const metrics = selectedPosition && positionMetrics[selectedPosition] 
                ? positionMetrics[selectedPosition] 
                : defaultMetrics;
            
            container.innerHTML = metrics.map(m => {
                const value = data[m] || 5;
                return `
                    <div class="bg-gradient-to-br from-slate-50 to-white p-5 rounded-2xl border border-slate-100 hover:border-emerald-200 transition">
                        <div class="flex justify-between text-[11px] font-bold mb-2">
                            <span class="text-slate-600 uppercase">${m}</span>
                            <span class="text-emerald-600 font-black text-lg" id="v-${m.replace(/\s/g, '')}">${value}</span>
                        </div>
                        <input type="range" min="0" max="10" step="0.5" value="${value}" 
                            class="w-full h-2 accent-emerald-500 cursor-pointer" 
                            oninput="updateMetricValue('${m.replace(/\s/g, '')}', this.value)" 
                            data-m="${m}">
                        <div class="flex justify-between text-[9px] text-slate-400 font-bold mt-1">
                            <span>0</span>
                            <span>5</span>
                            <span>10</span>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateOverallRating();
        }

        function updateMetricValue(metricId, value) {
            document.getElementById('v-' + metricId).innerText = value;
            updateOverallRating();
            updateRadarChart();
        }

        function updateOverallRating() {
            const metrics = {};
            document.querySelectorAll('[data-m]').forEach(i => metrics[i.dataset.m] = parseFloat(i.value));
            const rating = calculateOverallRating(metrics);
            document.getElementById('overall-rating').innerText = rating;
        }

        // Listen to position change to update metrics
        document.addEventListener('DOMContentLoaded', function() {
            const posSelect = document.getElementById('p-position');
            if (posSelect) {
                posSelect.addEventListener('change', function() {
                    const currentMetrics = {};
                    document.querySelectorAll('[data-m]').forEach(i => currentMetrics[i.dataset.m] = parseFloat(i.value));
                    renderMetricsInputs(currentMetrics, this.value);
                    updateRadarChart();
                });
            }
        });

        // RADAR CHART
        function updateRadarChart() {
            const metrics = {};
            const labels = [];
            const values = [];
            
            document.querySelectorAll('[data-m]').forEach(i => {
                labels.push(i.dataset.m);
                values.push(parseFloat(i.value));
            });
            
            if (radarChart) {
                radarChart.data.labels = labels;
                radarChart.data.datasets[0].data = values;
                radarChart.update();
            } else {
                const ctx = document.getElementById('radarChart');
                if (ctx) {
                    radarChart = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Avalia√ß√£o',
                                data: values,
                                backgroundColor: 'rgba(16, 185, 129, 0.2)',
                                borderColor: 'rgb(16, 185, 129)',
                                pointBackgroundColor: 'rgb(16, 185, 129)',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: 'rgb(16, 185, 129)',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 10,
                                    ticks: { stepSize: 2 }
                                }
                            },
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                }
            }
        }

        // VIDEO LINKS
        function addVideoLink() {
            const urlInput = document.querySelector('.video-url');
            const descInput = document.querySelector('.video-desc');
            const url = urlInput.value.trim();
            
            if (!url) return;
            
            currentVideos.push({
                url: url,
                description: descInput.value.trim() || 'V√≠deo sem descri√ß√£o',
                addedAt: new Date().toISOString()
            });
            
            urlInput.value = '';
            descInput.value = '';
            renderVideoList();
        }

        function renderVideoList() {
            const container = document.getElementById('video-list');
            if (!currentVideos || currentVideos.length === 0) {
                container.innerHTML = '<p class="text-slate-400 text-sm text-center py-4">Nenhum v√≠deo adicionado</p>';
                return;
            }
            
            container.innerHTML = currentVideos.map((v, idx) => `
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl">
                    <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"/></svg>
                    <div class="flex-1">
                        <a href="${v.url}" target="_blank" class="text-sm font-bold text-emerald-600 hover:underline">${v.description}</a>
                        <p class="text-xs text-slate-400">${v.url}</p>
                    </div>
                    <button onclick="removeVideo(${idx})" class="text-red-500 hover:text-red-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </button>
                </div>
            `).join('');
        }

        function removeVideo(idx) {
            currentVideos.splice(idx, 1);
            renderVideoList();
        }

        // EVALUATION HISTORY
        function renderEvaluationHistory(history) {
            const section = document.getElementById('evaluation-history-section');
            const timeline = document.getElementById('evaluation-timeline');
            
            if (!history || history.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            timeline.innerHTML = history.map(ev => `
                <div class="timeline-item">
                    <div class="timeline-dot"></div>
                    <div class="bg-slate-50 p-4 rounded-xl">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div class="font-bold text-slate-800">${formatDate(ev.date)}</div>
                                <div class="text-xs text-slate-500">${ev.scoutName || 'Scout'}</div>
                            </div>
                            <div class="text-2xl font-black text-emerald-600">${calculateOverallRating(ev.metrics)}</div>
                        </div>
                        ${ev.notes ? `<p class="text-sm text-slate-600 mt-2">${ev.notes}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // SAVE PLAYER
        function savePlayer() {
            const name = document.getElementById('p-name').value.trim();
            const position = document.getElementById('p-position').value;
            
            if (!name) {
                alert("‚ö†Ô∏è Insira o nome do atleta!");
                return;
            }
            
            if (!position) {
                alert("‚ö†Ô∏è Selecione a posi√ß√£o do atleta!");
                return;
            }
            
            const metrics = {};
            document.querySelectorAll('[data-m]').forEach(i => metrics[i.dataset.m] = parseFloat(i.value));
            
            const existingPlayer = players.find(p => p.id === currentId);
            const evaluationHistory = existingPlayer ? (existingPlayer.evaluationHistory || []) : [];
            
            // Add current evaluation to history if editing existing player
            if (existingPlayer) {
                evaluationHistory.push({
                    date: new Date().toISOString(),
                    metrics: metrics,
                    notes: document.getElementById('p-notes').value,
                    scoutName: 'Current Scout' // Can be made dynamic
                });
            }
            
            const data = {
                id: currentId,
                name: name,
                club: document.getElementById('p-club').value,
                age: parseInt(document.getElementById('p-age').value) || null,
                height: document.getElementById('p-height').value,
                position: position,
                position2: document.getElementById('p-position2').value,
                foot: document.getElementById('p-foot').value,
                nationality: document.getElementById('p-nationality').value,
                agent: document.getElementById('p-agent').value,
                contractEnd: document.getElementById('p-contract-end').value,
                releaseClause: document.getElementById('p-release-clause').value,
                marketValue: document.getElementById('p-market-value').value,
                tag: document.getElementById('p-tag').value,
                negotiation: document.getElementById('p-negotiation').value,
                goals: parseInt(document.getElementById('p-goals').value) || 0,
                assists: parseInt(document.getElementById('p-assists').value) || 0,
                minutes: parseInt(document.getElementById('p-minutes').value) || 0,
                games: parseInt(document.getElementById('p-games').value) || 0,
                playstyle: document.getElementById('p-playstyle').value,
                system: document.getElementById('p-system').value,
                strengths: document.getElementById('p-strengths').value,
                weaknesses: document.getElementById('p-weaknesses').value,
                injuries: document.getElementById('p-injuries').value,
                notes: document.getElementById('p-notes').value,
                photo: tempPhoto,
                videos: currentVideos,
                metrics: metrics,
                evaluationHistory: evaluationHistory,
                lastUpdated: new Date().toISOString()
            };
            
            const idx = players.findIndex(p => p.id === currentId);
            if (idx > -1) {
                players[idx] = data;
            } else {
                players.push(data);
            }
            
            localStorage.setItem('scoutflow_advanced_v1', JSON.stringify(players));
            
            // Show success message
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<svg class="w-4 h-4 inline-block animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg> Guardando...';
            
            setTimeout(() => {
                btn.innerHTML = '‚úì Guardado!';
                setTimeout(() => {
                    showView('home');
                }, 500);
            }, 500);
        }

        function deletePlayer() {
            if (!confirm('‚ö†Ô∏è Tem a certeza que deseja eliminar este atleta? Esta a√ß√£o n√£o pode ser revertida.')) return;
            
            players = players.filter(p => p.id !== currentId);
            localStorage.setItem('scoutflow_advanced_v1', JSON.stringify(players));
            showView('home');
        }

        // PHOTO UPLOAD
        function handlePhoto(input) {
            if (!input.files || !input.files[0]) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                tempPhoto = e.target.result;
                document.getElementById('photo-preview').innerHTML = `<img src="${tempPhoto}" class="w-full h-full object-cover">`;
            };
            reader.readAsDataURL(input.files[0]);
        }

        // ANALYTICS
        function renderAnalytics() {
            // Calculate stats
            const total = players.length;
            const avgAge = total > 0 ? (players.reduce((sum, p) => sum + (p.age || 0), 0) / total).toFixed(1) : 0;
            const avgRating = total > 0 ? (players.reduce((sum, p) => sum + parseFloat(calculateOverallRating(p.metrics || {})), 0) / total).toFixed(1) : 0;
            const promises = players.filter(p => p.tag === 'promessa').length;
            
            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-avg-age').textContent = avgAge;
            document.getElementById('stat-avg-rating').textContent = avgRating;
            document.getElementById('stat-promises').textContent = promises;
            
            // Position distribution
            const positionCounts = {};
            players.forEach(p => {
                if (p.position) {
                    positionCounts[p.position] = (positionCounts[p.position] || 0) + 1;
                }
            });
            
            new Chart(document.getElementById('positionChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(positionCounts),
                    datasets: [{
                        data: Object.values(positionCounts),
                        backgroundColor: ['#10b981', '#3b82f6', '#8b5cf6', '#f59e0b', '#ef4444', '#ec4899', '#14b8a6', '#f97316']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Age distribution
            const ageCounts = { '0-18': 0, '19-21': 0, '22-25': 0, '26-30': 0, '30+': 0 };
            players.forEach(p => {
                const age = p.age || 0;
                if (age <= 18) ageCounts['0-18']++;
                else if (age <= 21) ageCounts['19-21']++;
                else if (age <= 25) ageCounts['22-25']++;
                else if (age <= 30) ageCounts['26-30']++;
                else ageCounts['30+']++;
            });
            
            new Chart(document.getElementById('ageChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(ageCounts),
                    datasets: [{
                        label: 'Atletas',
                        data: Object.values(ageCounts),
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // Top players
            const topPlayers = [...players]
                .sort((a, b) => calculateOverallRating(b.metrics || {}) - calculateOverallRating(a.metrics || {}))
                .slice(0, 10);
            
            new Chart(document.getElementById('topPlayersChart'), {
                type: 'horizontalBar',
                data: {
                    labels: topPlayers.map(p => p.name),
                    datasets: [{
                        label: 'Avalia√ß√£o',
                        data: topPlayers.map(p => calculateOverallRating(p.metrics || {})),
                        backgroundColor: '#10b981'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { x: { beginAtZero: true, max: 10 } }
                }
            });
            
            // Tags distribution
            const tagCounts = {};
            players.forEach(p => {
                if (p.tag) {
                    tagCounts[p.tag] = (tagCounts[p.tag] || 0) + 1;
                }
            });
            
            new Chart(document.getElementById('tagsChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(tagCounts).map(t => ({
                        'promessa': 'üåü Promessa',
                        'urgente': 'üî• Urgente',
                        'monitorar': 'üëÅÔ∏è Monitorar',
                        'contactado': '‚úÖ Contactado',
                        'descartado': '‚ùå Descartado'
                    }[t])),
                    datasets: [{
                        data: Object.values(tagCounts),
                        backgroundColor: ['#fef3c7', '#fee2e2', '#dbeafe', '#d1fae5', '#f1f5f9']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // COMPARISON
        function initComparison() {
            const selects = ['compare-player-1', 'compare-player-2', 'compare-player-3'];
            selects.forEach(id => {
                const select = document.getElementById(id);
                select.innerHTML = '<option value="">Selecionar...</option>' + 
                    players.map(p => `<option value="${p.id}">${p.name} (${p.position || 'N/A'})</option>`).join('');
            });
            updateComparison();
        }

        function updateComparison() {
            const ids = [
                document.getElementById('compare-player-1').value,
                document.getElementById('compare-player-2').value,
                document.getElementById('compare-player-3').value
            ].filter(id => id);
            
            const selectedPlayers = ids.map(id => players.find(p => p.id === id)).filter(p => p);
            const container = document.getElementById('comparison-content');
            
            if (selectedPlayers.length === 0) {
                container.innerHTML = '<div class="glass-card p-20 text-center text-slate-400">Selecione atletas para comparar</div>';
                return;
            }
            
            // Radar comparison
            const allMetrics = new Set();
            selectedPlayers.forEach(p => Object.keys(p.metrics || {}).forEach(m => allMetrics.add(m)));
            const metricsList = Array.from(allMetrics);
            
            container.innerHTML = `
                <div class="glass-card p-6 mb-6">
                    <h3 class="font-bold text-slate-800 mb-4">Compara√ß√£o de Perfil T√©cnico</h3>
                    <canvas id="comparisonRadar" height="120"></canvas>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-${selectedPlayers.length} gap-6">
                    ${selectedPlayers.map(p => `
                        <div class="glass-card p-6">
                            <div class="text-center mb-4">
                                ${p.photo ? `<img src="${p.photo}" class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-4 border-emerald-500">` : 
                                    `<div class="w-32 h-32 rounded-full mx-auto mb-4 bg-slate-100 flex items-center justify-center">
                                        <svg class="w-16 h-16 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                    </div>`}
                                <h3 class="font-black text-xl text-slate-800">${p.name}</h3>
                                <p class="text-sm text-slate-500">${p.club || 'N/A'}</p>
                                <div class="text-3xl font-black text-emerald-600 mt-2">${calculateOverallRating(p.metrics || {})}</div>
                            </div>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between"><span class="text-slate-600">Idade:</span><strong>${p.age || 'N/A'}</strong></div>
                                <div class="flex justify-between"><span class="text-slate-600">Posi√ß√£o:</span><strong>${p.position || 'N/A'}</strong></div>
                                <div class="flex justify-between"><span class="text-slate-600">Altura:</span><strong>${p.height ? p.height + 'cm' : 'N/A'}</strong></div>
                                <div class="flex justify-between"><span class="text-slate-600">P√©:</span><strong>${p.foot || 'N/A'}</strong></div>
                                <div class="flex justify-between"><span class="text-slate-600">Golos:</span><strong>${p.goals || 0}</strong></div>
                                <div class="flex justify-between"><span class="text-slate-600">Assist√™ncias:</span><strong>${p.assists || 0}</strong></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="glass-card p-6 mt-6">
                    <h3 class="font-bold text-slate-800 mb-4">Compara√ß√£o M√©trica por M√©trica</h3>
                    <div class="space-y-4">
                        ${metricsList.map(metric => `
                            <div>
                                <div class="text-sm font-bold text-slate-600 mb-2">${metric}</div>
                                <div class="grid grid-cols-${selectedPlayers.length} gap-4">
                                    ${selectedPlayers.map(p => {
                                        const value = (p.metrics && p.metrics[metric]) || 0;
                                        return `
                                            <div>
                                                <div class="metric-bar">
                                                    <div class="metric-fill" style="width: ${value * 10}%"></div>
                                                </div>
                                                <div class="text-xs text-center mt-1 font-bold text-emerald-600">${value}</div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            // Render comparison radar
            const colors = ['rgba(16, 185, 129, 0.6)', 'rgba(59, 130, 246, 0.6)', 'rgba(139, 92, 246, 0.6)'];
            const datasets = selectedPlayers.map((p, idx) => ({
                label: p.name,
                data: metricsList.map(m => (p.metrics && p.metrics[m]) || 0),
                backgroundColor: colors[idx],
                borderColor: colors[idx].replace('0.6', '1'),
                borderWidth: 2
            }));
            
            new Chart(document.getElementById('comparisonRadar'), {
                type: 'radar',
                data: {
                    labels: metricsList,
                    datasets: datasets
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10
                        }
                    }
                }
            });
        }

        // EXPORT / IMPORT
        function exportAllData() {
            const dataStr = JSON.stringify(players, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `scoutflow_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const imported = JSON.parse(event.target.result);
                        if (confirm(`Importar ${imported.length} atletas? Isto ir√° substituir os dados atuais.`)) {
                            players = imported;
                            localStorage.setItem('scoutflow_advanced_v1', JSON.stringify(players));
                            renderGrid();
                            alert('‚úì Dados importados com sucesso!');
                        }
                    } catch (err) {
                        alert('‚ùå Erro ao importar ficheiro. Verifique o formato.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function exportPlayerPDF() {
            // This is a placeholder - full PDF generation would require jsPDF setup
            alert('Funcionalidade de exporta√ß√£o PDF em desenvolvimento. Use o atalho Ctrl+P para imprimir a p√°gina.');
        }

        // KEYBOARD SHORTCUTS
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'n') {
                    e.preventDefault();
                    prepareNewPlayer();
                } else if (e.key === 's' && document.getElementById('view-editor').classList.contains('hidden') === false) {
                    e.preventDefault();
                    savePlayer();
                }
            }
            if (e.key === '/' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                document.getElementById('search-input').focus();
            }
        });

        // INIT
        window.onload = () => {
            showView('home');
        };
  // === INTEGRA√á√ÉO DE MEM√ìRIA E UNDO (IN√çCIO) ===

// 1. Carregar dados guardados ao abrir a p√°gina
let players = JSON.parse(localStorage.getItem('scoutflow_players')) || [];
let historyStack = [];

// 2. Fun√ß√£o para salvar o estado antes de qualquer altera√ß√£o
function saveToHistory() {
    historyStack.push(JSON.stringify(players));
    if (historyStack.length > 20) historyStack.shift();
}

// 3. Fun√ß√£o Desfazer (Undo)
function undo() {
    if (historyStack.length > 0) {
        players = JSON.parse(historyStack.pop());
        localStorage.setItem('scoutflow_players', JSON.stringify(players));
        // Tenta chamar a tua fun√ß√£o de atualizar a lista
        if (typeof renderPlayerGrid === 'function') renderPlayerGrid();
        alert("A√ß√£o desfeita!");
    }
}

// 4. Atalho CTRL+Z
window.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
        e.preventDefault();
        undo();
    }
});

// 5. Garante que a tua lista carrega do LocalStorage ao iniciar
window.addEventListener('load', () => {
    if (typeof renderPlayerGrid === 'function') renderPlayerGrid();
});

// === INTEGRA√á√ÉO DE MEM√ìRIA E UNDO (FIM) ===
    </script> 
</body>
</html>
