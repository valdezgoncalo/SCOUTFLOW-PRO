<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScoutFlow Pro - Elite Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        .dark-card { background-color: #1e293b; border: 1px solid #334155; }
        .hidden { display: none; }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 font-sans min-h-screen">

    <div class="flex flex-col md:flex-row min-h-screen">
        <aside class="w-full md:w-64 bg-slate-900 border-r border-slate-800 p-4 space-y-6">
            <h1 class="text-2xl font-black text-blue-500 tracking-tighter">SCOUTFLOW</h1>
            
            <div class="space-y-2">
                <p class="text-xs font-bold text-slate-500 uppercase px-2">Gest√£o</p>
                <button onclick="showView('list')" class="w-full text-left px-3 py-2 rounded hover:bg-slate-800 transition">üìã Lista de Atletas</button>
                <button onclick="createNewPlayer()" class="w-full text-left px-3 py-2 rounded bg-blue-600 hover:bg-blue-500 transition font-bold">+ Novo Atleta</button>
            </div>

            <div id="players-side-list" class="space-y-1 pt-4 border-t border-slate-800">
                </div>
        </aside>

        <main class="flex-1 flex flex-col">
            <header class="p-4 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center sticky top-0 z-10 backdrop-blur-md">
                <h2 id="current-player-name" class="text-xl font-bold italic text-slate-300 underline decoration-blue-500">Seleciona um atleta</h2>
                <div class="flex gap-2">
                    <button onclick="showView('report')" class="bg-emerald-600 px-4 py-2 rounded text-sm font-bold hover:bg-emerald-500">Live Match</button>
                    <button onclick="exportToPDF()" class="bg-slate-700 px-4 py-2 rounded text-sm font-bold hover:bg-slate-600">Exportar PDF</button>
                </div>
            </header>

            <div id="content-area" class="p-6 overflow-y-auto">
                <section id="view-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </section>

                <section id="view-dashboard" class="hidden space-y-8" id="pdf-export-content">
                    
                    <div id="metrics-container" class="space-y-10">
                        </div>

                    <div class="dark-card p-6 rounded-xl border-l-4 border-yellow-500">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-bold text-lg">üïí Hist√≥rico de Observa√ß√£o</h3>
                            <button onclick="undoLastAction()" class="bg-yellow-600 px-3 py-1 rounded text-xs font-bold hover:bg-yellow-500 shadow-lg">UNDO</button>
                        </div>
                        <div id="history-log" class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs"></div>
                    </div>
                </section>

                <section id="view-report" class="hidden max-w-2xl mx-auto space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="logAction('Passe OK', 'emerald')" class="h-24 bg-emerald-700 rounded-xl font-bold shadow-lg">Passe ‚úÖ</button>
                        <button onclick="logAction('Passe Erro', 'red')" class="h-24 bg-red-700 rounded-xl font-bold shadow-lg">Passe ‚ùå</button>
                        <button onclick="logAction('Recup. Bola', 'blue')" class="h-24 bg-blue-700 rounded-xl font-bold shadow-lg">Recupera√ß√£o üõ°Ô∏è</button>
                        <button onclick="logAction('Drible OK', 'indigo')" class="h-24 bg-indigo-700 rounded-xl font-bold shadow-lg">Drible ‚ö°</button>
                    </div>
                    <div class="dark-card p-4">
                        <p class="text-center text-slate-400">Est√°s a registar a√ß√µes em tempo real para o atleta selecionado.</p>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // --- BASE DE DADOS E ESTRUTURA ---
        const metricCategories = [
            { title: "F√≠sicas / Condicionamento", color: "blue", fields: ["Velocidade M√°xima", "Resist√™ncia Aer√≥bica", "Resist√™ncia Anaer√≥bica", "For√ßa Inferior/Superior", "Explos√£o / Pot√™ncia", "Flexibilidade", "Agilidade", "Recupera√ß√£o"] },
            { title: "T√©cnicas", color: "emerald", fields: ["Passe (C/M/L)", "Rece√ß√£o / Dom√≠nio", "Remate / Finaliza√ß√£o", "Condu√ß√£o / Drible", "Cabeceamento", "T√©cnicas Defensivas", "Bolas Paradas"] },
            { title: "T√°ticas / Intelig√™ncia", color: "purple", fields: ["Posicionamento", "Leitura de Jogo", "Tomada de Decis√£o", "Participa√ß√£o Coletiva", "Versatilidade", "Press√£o / Recupera√ß√£o"] },
            { title: "Psicol√≥gicas / Mentais", color: "rose", fields: ["Resili√™ncia", "Concentra√ß√£o", "Disciplina", "Motiva√ß√£o / Atitude", "Controlo Emocional"] }
        ];

        let players = JSON.parse(localStorage.getItem('scout_players')) || [
            { id: 1, name: "Jo√£o Silva", position: "M√©dio", metrics: {}, history: [] }
        ];
        let currentPlayerId = null;

        // --- NAVEGA√á√ÉO ---
        function showView(view) {
            ['view-list', 'view-dashboard', 'view-report'].forEach(v => document.getElementById(v).classList.add('hidden'));
            document.getElementById('view-' + view).classList.remove('hidden');
        }

        // --- GEST√ÉO DE ATLETAS ---
        function renderPlayerLists() {
            const side = document.getElementById('players-side-list');
            const mainList = document.getElementById('view-list');
            side.innerHTML = ''; mainList.innerHTML = '';

            players.forEach(p => {
                side.innerHTML += `<button onclick="selectPlayer(${p.id})" class="w-full text-left text-sm px-3 py-1 text-slate-400 hover:text-white">${p.name}</button>`;
                mainList.innerHTML += `
                    <div class="dark-card p-6 rounded-xl hover:border-blue-500 transition cursor-pointer" onclick="selectPlayer(${p.id})">
                        <div class="text-2xl mb-2">üë§</div>
                        <h3 class="font-bold text-lg">${p.name}</h3>
                        <p class="text-slate-500 text-sm">${p.position}</p>
                    </div>`;
            });
        }

        function selectPlayer(id) {
            currentPlayerId = id;
            const p = players.find(x => x.id === id);
            document.getElementById('current-player-name').innerText = p.name + " (" + p.position + ")";
            renderMetrics(p);
            renderHistory(p);
            showView('dashboard');
        }

        function createNewPlayer() {
            const name = prompt("Nome do Atleta:");
            if (!name) return;
            const newP = { id: Date.now(), name: name, position: "Por definir", metrics: {}, history: [] };
            players.push(newP);
            save();
            renderPlayerLists();
        }

        // --- GEST√ÉO DE M√âTRICAS ---
        function renderMetrics(player) {
            const container = document.getElementById('metrics-container');
            container.innerHTML = '';

            metricCategories.forEach(cat => {
                let html = `<div class="space-y-4">
                    <h3 class="text-sm font-black uppercase tracking-widest text-${cat.color}-500 border-b border-${cat.color}-500/30 pb-2">${cat.title}</h3>
                    <div class="metric-grid">`;
                
                cat.fields.forEach(f => {
                    const val = player.metrics[f] || 50;
                    html += `
                        <div class="bg-slate-900/50 p-3 rounded-lg border border-slate-800 shadow-inner">
                            <div class="flex justify-between text-[10px] mb-2 text-slate-400 font-bold uppercase">
                                <span>${f}</span>
                                <span class="text-${cat.color}-400" id="val-${f}">${val}</span>
                            </div>
                            <input type="range" value="${val}" class="w-full h-1.5 accent-${cat.color}-500" oninput="updateMetric('${f}', this.value)">
                        </div>`;
                });
                html += `</div></div>`;
                container.innerHTML += html;
            });
        }

        function updateMetric(field, val) {
            const p = players.find(x => x.id === currentPlayerId);
            p.metrics[field] = val;
            document.getElementById(`val-${field}`).innerText = val;
            save();
        }

        // --- SISTEMA DE LOG / UNDO ---
        function logAction(action, color) {
            if(!currentPlayerId) return alert("Seleciona um atleta primeiro!");
            const p = players.find(x => x.id === currentPlayerId);
            const entry = { id: Date.now(), text: action, color: color, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) };
            p.history.push(entry);
            save();
            renderHistory(p);
        }

        function undoLastAction() {
            const p = players.find(x => x.id === currentPlayerId);
            p.history.pop();
            save();
            renderHistory(p);
        }

        function renderHistory(p) {
            const log = document.getElementById('history-log');
            log.innerHTML = p.history.slice().reverse().map(i => `
                <div class="bg-slate-800 p-2 rounded border-l-2 border-${i.color}-500 flex justify-between">
                    <span>${i.text}</span> <span class="text-slate-500">${i.time}</span>
                </div>
            `).join('');
        }

        // --- EXPORTA√á√ÉO E PERSIST√äNCIA ---
        function save() { localStorage.setItem('scout_players', JSON.stringify(players)); }

        async function exportToPDF() {
            if(!currentPlayerId) return;
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const p = players.find(x => x.id === currentPlayerId);
            
            doc.setFontSize(22);
            doc.text("Relat√≥rio de Scouting: " + p.name, 20, 20);
            doc.setFontSize(12);
            doc.text("Data: " + new Date().toLocaleDateString(), 20, 30);
            
            let y = 50;
            doc.text("M√©tricas Principais:", 20, y);
            y += 10;
            
            Object.keys(p.metrics).forEach(m => {
                if (y > 270) { doc.addPage(); y = 20; }
                doc.text(`${m}: ${p.metrics[m]}/100`, 30, y);
                y += 8;
            });

            doc.save(`ScoutFlow_${p.name}.pdf`);
        }

        renderPlayerLists();
    </script>
</body>
</html>
